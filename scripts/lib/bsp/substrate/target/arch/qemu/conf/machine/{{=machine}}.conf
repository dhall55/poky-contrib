#@TYPE: Machine
#@NAME: {{=machine}}

#@DESCRIPTION: Machine configuration for {{=machine}} systems

PREFERRED_PROVIDER_virtual/xserver ?= "xserver-xorg"

PREFERRED_PROVIDER_virtual/kernel ?= "linux-yocto"
PREFERRED_VERSION_linux-yocto ?= "3.0%"

{{ input type:"choicelist" name:"qemuarch" prio:"1" msg:"Which qemu architecture would you like to use?" }}
{{ input type:"choice" val:"x86" msg:"common 32-bit x86" }}
{{ input type:"choice" val:"x86_64" msg:"common 64-bit x86" }}
{{ input type:"choice" val:"arm" msg:"common 32-bit ARM" }}
{{ input type:"choice" val:"powerpc" msg:"common 32-bit PowerPC" }}
{{ input type:"choice" val:"mips" msg:"common 32-bit MIPS" }}
{{ if qemuarch == "x86": }}
require conf/machine/include/tune-i586.inc
{{ if qemuarch == "x86_64": }}
require conf/machine/include/tune-i586.inc
{{ if qemuarch == "arm": }}
require conf/machine/include/tune-arm926ejs.inc
{{ if qemuarch == "powerpc": }}
require conf/machine/include/tune-ppc603e.inc
{{ if qemuarch == "mips": }}
require conf/machine/include/tune-mips32.inc

require conf/machine/include/qemu.inc

{{ if qemuarch == "x86" or qemuarch == "x86_64": }}
MACHINE_FEATURES += "x86"
KERNEL_IMAGETYPE = "bzImage"
SERIAL_CONSOLE = "115200 ttyS0"
# We bypass swrast but we need it to be present for X to load correctly
XSERVER ?= "xserver-xorg \
           mesa-dri-driver-swrast \
           xf86-input-vmmouse \
           xf86-input-keyboard \
           xf86-input-evdev \
           xf86-video-vmware \
           qemugl"
GLIBC_ADDONS = "nptl"
GLIBC_EXTRA_OECONF = "--with-tls"

{{ if qemuarch == "arm": }}
KERNEL_IMAGETYPE = "zImage"
SERIAL_CONSOLE = "115200 ttyAMA0"

{{ if qemuarch == "powerpc": }}
KERNEL_IMAGETYPE = "vmlinux"
SERIAL_CONSOLE = "115200 ttyS0"

{{ if qemuarch == "mips": }}
KERNEL_IMAGETYPE = "vmlinux"
KERNEL_ALT_IMAGETYPE = "vmlinux.bin"
SERIAL_CONSOLE = "115200 ttyS0"
MACHINE_EXTRA_RRECOMMENDS = " kernel-modules"
