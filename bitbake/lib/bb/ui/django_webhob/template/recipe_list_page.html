<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Web hob - Image Creator Demo</title>
<link type="text/css" rel="stylesheet" href="static/css/base.css">
<link type="text/css" rel="stylesheet" href="static/css/main.css">
<script type="text/javascript" src="static/js/jquery.min.js"></script>
<script type="text/javascript" src="static/js/jquery.skygqbox.1.3.js"></script>
<!--script type="text/javascript" src="js/vtip.js"></script-->
<script type="text/javascript">
var selected_items = {{dep.dep_len}};
var slct_item = null;
$(function(){
	/*------------ click the checkbox deps to show right div ------------------------*/
	$('input[name="include_item"]').each(function(){
		$(this).click(
			function(){
				if(!$(this).is(":checked")){
					return false;
				}
				else{
					slct_item = $(this).val();
					$.ajax({
							url:'ajax_rcp_include',
							type:'GET',
							data:({'rcp_item':slct_item}),
							beforeSend:function(){
								$('#loading').show();
							},
							success:function(data,s){
								json = jQuery.parseJSON(data);
								json = json.rcp_list;
								for(var i=0; i<json.length; i++){
									var innerjson = json[i].item;
									if($('.selectedrecipes').text().indexOf(innerjson+',') < 0){
										selected_items++;

										$('.selectedrecipes').prepend(innerjson+', ');
										$('.user_rcp_list').prepend(innerjson+', ');
									}

									$('input[name="include_item"]').not("input:checked").each(function(){
										if(innerjson == $(this).val()){
											$(this).attr("checked",'true');
										}

									});
								}
								$('.selected_items').text(selected_items);
								$('#loading').hide();
							},
							dataType:'html'
					});

				}
			  });
	});

	/*------------ tabs switch------------------------*/
   $("#tab dl dd").each(function(i){
	   $(this).click(
		  function(){
			  $("#tab dl dd").removeClass("on");
			  $(this).addClass("on");
			  $("#tab ul").children('li').hide();
			  $("#tab ul").children('li').eq(i).show();
	  })
   })
});
</script>
</head>
<body>

<div class="wrap">
	<div class='tab_wrap' id='tab'>
		<dl>
			<dd class='on'>Recipes</dd>
			<dd>Recipe Collections</dd>
		</dl>
		<ul>
			<li>
				<ol>
					<li class='l'>
					<table class='rcp_table_out'>
						<thead>
							<tr>
								<th width='5%' scope="col">ID</td>
								<th width='25%' scope="col">Recipe</th>
								<th width='30%' scope="col">License</th>
								<th width='30%' scope="col">Group</th>
								<th width='10%' scope="col">Included</th>
							</tr>
						</thead>
					<tbody>
					<tr><td colspan="5" class='wrap_td'>
					<div>
					<table>
						{% for k, v in sort_rcps %}
							<tr>
							<td width='5%'>{{forloop.counter}}</td>
							<td width='30%'><a href="#"  title='{{v.summary}}'>{{k}}</a></td>
							<td width='30%'>{{v.license}}</td>
							<td width='30%'>{{v.section}}</td>
							<td width='5%'><input name='include_item' type='checkbox' value='{{k}}' {% if v.include %}checked{% endif %}/></td>
							</tr>
						{% endfor %}
					</table>
					</div>
					</td></tr>
					</tbody>
					<tfoot>
						<tr>
						<td colspan="5">Total: {{sort_rcps_total}} recipes</td>
						</tr>
					</tfoot>

				</table>
				</li>
				<li class='r'>
					<h3 >Selected <span class='selected_items'>{{dep.dep_len}}</span> recipes</h3>
					<div class='selectedrecipes'>{% for item in dep.dep_list %}{{item}}, {% endfor %}</div>
				</li>
				</ol>
            </li>
			<li style='display:none'>
				<ol>
					<li class='l'>
					<table class='rcp_table_out'>
						<thead>
						<tr>
							<th width='5%' scope="col">ID</td>
							<th width='25%' scope="col">Recipe</th>
							<th width='30%' scope="col">License</th>
							<th width='30%' scope="col">Group</th>
							<th width='10%' scope="col">Included</th>
						</tr>
						</thead>
					<tbody>
					<tr><td colspan="5" class='wrap_td'>
					<div>
					<table>
						{% for k, v in sort_rcps_tasks %}
							<tr>
							<td width='5%'>{{forloop.counter}}</td>
							<td width='30%'><a href="#"  title='{{v.summary}}'>{{k}}</a></td>
							<td width='30%'>{{v.license}}</td>
							<td width='30%'>{{v.section}}</td>
							<td width='5%'><input type='checkbox' value='{{item.0}}' {#% if v.include %}checked{% endif %#} disabled/></td>
							</tr>
						{% endfor %}
					</table>
					</div>
					</td></tr>
					</tbody>
					<tfoot>
						<tr>
						<td colspan="5">Total: {{sort_rcps_tasks_total}} recipes collections</td>
						</tr>
					</tfoot>

				</table>
				</li>
				<li class='r'>
					<h3 >Selected <span class='selected_items'>{{dep.dep_len}}</span> recipes</h3>
					<div class='selectedrecipes'>{% for item in dep.dep_list %}{{item}}, {% endfor %}</div>
				</li>
				</ol>
			</li>
		</ul>
	</div>
	<script>
	$(document).ready(function(){
		$('#buildpackage').click(function(){
			$('#buildpackage').submit();
		});
	});
</script>

	<form method='post' id='buildpackage' action='/send_command_buildpackage'>
		<div class='main_conf' id='build_p_i'>
		<div style='float:right'>
			<textarea rows="" cols="" name='user_rcp_list' class='user_rcp_list' style='display:none;'>{% for item in dep.dep_list %}{{item}}, {% endfor %}</textarea>
			<input type='hidden' name='r_l_baseimg' value="{{baseimg}}" />
			<input class='build_button' id='build_pkg' type="button" value="Build Packages" />
 	</div>
 	</form>
</div>

<div id='loading'>Loading</div>
</body>
</html>