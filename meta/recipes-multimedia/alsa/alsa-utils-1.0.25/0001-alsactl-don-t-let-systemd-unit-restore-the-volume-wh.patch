From 37c99a3cbff36915b56a5703eeaed3c70796f80f Mon Sep 17 00:00:00 2001
From: Koen Kooi <koen@dominion.thruhere.net>
Date: Sun, 9 Oct 2011 20:06:35 +0200
Subject: [PATCH] alsactl: don't let systemd unit restore the volume when asound.state is missing

This avoids an error on bootup

Signed-off-by: Koen Kooi <koen@dominion.thruhere.net>
Signed-off-by: Shane Wang <shane.wang@intel.com>
---

Filed as https://bugtrack.alsa-project.org/alsa-bug/view.php?id=5459

Upstream-Status: Pending

 alsactl/Makefile.am             |    2 +-
 alsactl/alsa-restore.service.in |    1 +
 2 files changed, 2 insertions(+), 1 deletions(-)

diff -r 6f4209c9b022 alsactl/Makefile.am
--- a/alsactl/Makefile.am	Wed Mar 14 12:30:42 2012 +0800
+++ b/alsactl/Makefile.am	Wed Mar 14 12:33:27 2012 +0800
@@ -34,7 +34,8 @@
 endif
 
 edit = \
-	$(SED) -r 's,@sbindir\@,$(sbindir),g' < $< > $@ || rm $@
+	$(SED) -e 's,@localstatedir\@,$(localstatedir),g' -e 's,@sbindir\@,$(sbindir),g' < $< > $@ || rm $@
 
 alsa-store.service: alsa-store.service.in
 	$(edit)
diff -r 6f4209c9b022 alsactl/alsa-restore.service.in
--- a/alsactl/alsa-restore.service.in	Wed Mar 14 12:30:42 2012 +0800
+++ b/alsactl/alsa-restore.service.in	Wed Mar 14 12:33:27 2012 +0800
@@ -4,6 +4,7 @@
 After=sysinit.target
 Before=shutdown.target
 Conflicts=shutdown.target
+ConditionPathExists=@localstatedir@/lib/alsa/asound.state
 
 [Service]
 Type=oneshot
